<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>ピンポンゲーム</title>
<style>
  :root{
    --bg:#0b1023; --panel:#0f172a; --text:#e5e7eb; --muted:#9ca3af;
    --accent:#22d3ee; --brick:#94a3b8; --ball:#fbbf24;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Hiragino Sans","Noto Sans JP","Yu Gothic UI",sans-serif;overflow:hidden}
  /* ヘッダー：タイトル右にスコア */
  header{
    padding:10px 14px;
    border-bottom:1px solid rgba(255,255,255,.08);
    background:var(--panel);
    display:flex;align-items:center;justify-content:space-between;gap:12px;
  }
  h1{margin:0;font-size:18px;white-space:nowrap}
  .score{font-weight:800;background:#111827;border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:999px;font-variant-numeric:tabular-nums}
  main{
    height:calc(100dvh - 48px); /* 1画面完結（iOSのアドレスバー対策にdvh） */
    max-width:980px;margin:0 auto;padding:12px;display:flex;flex-direction:column
  }
  /* ステージ：スクロール無し・常に1画面内 */
  .stage{
    position:relative;flex:1;border:1px solid rgba(255,255,255,.06);
    border-radius:12px;overflow:hidden;background:linear-gradient(180deg,#0f172a,#0b1023)
  }
  canvas{width:100%;height:100%;display:block;touch-action:none}
  .overlay{
    position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
    background:rgba(0,0,0,.28);text-align:center;gap:12px;flex-direction:column
  }
  .sheet{background:#0b1220;border:1px solid rgba(255,255,255,.16);padding:18px;border-radius:14px;max-width:90vw;box-shadow:0 20px 50px rgba(0,0,0,.55)}
  .btn{
    appearance:none;border:1px solid rgba(255,255,255,.2);background:#1f2937;color:var(--text);
    padding:12px 20px;border-radius:12px;cursor:pointer;font-weight:700;touch-action:manipulation
  }
  .btn:active{transform:translateY(1px)}
  .hidden{display:none}
</style>
</head>
<body>
  <header>
    <h1>ピンポンゲーム</h1>
    <div class="score">SCORE: <span id="score">0</span></div>
  </header>

  <main>
    <div class="stage" id="stage">
      <canvas id="game" width="720" height="1080" aria-label="ゲーム画面"></canvas>
      <div id="overlay" class="overlay" role="dialog" aria-modal="true">
        <div class="sheet">
          <div id="title" style="font-weight:800;font-size:22px;margin-bottom:8px">START</div>
          <div id="sub" style="color:var(--muted);font-size:12px">タップして開始（スマホ：ドラッグ/スワイプ、PC：← →）</div>
        </div>
        <button id="btnStart" class="btn" aria-label="ゲーム開始">START</button>
      </div>
    </div>
  </main>

<script>
/* ====== 設定 ====== */
const CFG = {
  paddleW: 140, paddleH: 16, paddleSpeed: 900,
  ballR: 10, baseBallSpeed: 420, speedCap: 900,
  rows: 6, cols: 9, brickW: 64, brickH: 22, brickGap: 8, topOffset: 90,
  addBallEvery: 7,
  speedUpFactor: 1.12
};

/* ====== 要素 ====== */
const canvas = do
